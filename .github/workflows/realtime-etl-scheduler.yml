name: Realtime ETL Scheduler (Execution Only)

on:
  # Scheduler trigger (Control-M / cron equivalent)
  schedule:
    - cron: "30 4 * * *"   # every 5 minutes

  # Manual trigger for demo
  workflow_dispatch:

jobs:
  run-etl:
    runs-on: ubuntu-latest

    permissions:
      contents: read

    steps:
      # 1️⃣ Login to Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      # 2️⃣ Execute ETL component (REAL-TIME)
      - name: Run ETL Component
        run: |
          echo "========================================"
          echo "Starting scheduled ETL execution"
          echo "Time: $(date)"
          echo "========================================"

          docker run --rm \
            -e COMPONENT_NAME=user_flow_etl \
            -e INPUT_DATA='{"source":"scheduler","type":"realtime"}' \
            bindumounica87/etl-component:graph-user-flow-v1.1.1

          echo "========================================"
          echo "ETL execution completed"
          echo "========================================"
